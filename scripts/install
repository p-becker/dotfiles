#!/bin/sh
git clone https://github.com/tmux-plugins/tpm ~/.tmux/plugins/tpm
# TODO: handle $DOTFILES_PATH not set on first install
# TODO: move into dotfiles folder
export ZDOTDIR=$DOTFILES_PATH/zsh
git clone --recursive https://github.com/sorin-ionescu/prezto.git "${ZDOTDIR:-$HOME}/.zprezto"

declare -a formulas=("zsh" "fzf" "tmux" "rbenv" "nvim" "Ack" "python3")

## now loop through the above array
for f in "${formulas[@]}"; do
	if ! command -v "$f" >/dev/null; then
	       while true; do
		read -p "Do you wish to install $f? [Yy/Nn]: " yn
		case $yn in
			[Yy]* ) brew install "$f"; break;;
			[Nn]* ) exit;;
			* ) echo "Please answer yes [Yy] or no [Nn].";;
		esac
		done
	else
		echo "$f is already installed."
	fi
done

# Install vim-plug for neovim
curl -fLo ~/.local/share/nvim/site/autoload/plug.vim --create-dirs \
    https://raw.githubusercontent.com/junegunn/vim-plug/master/plug.vim
nvim  -c "PlugInstall" -c "qa"

mkdir -p ~/.vim/colors

git config --global core.editor $(which nvim)
git config --global core.excludesfile "$PWD"/.gitignore

# Vim colors
cp color-schemes/railscasts/base16-railscasts.vim ~/.vim/colors/
cp color-schemes/lucius/lucius.vim ~/.vim/colors/

# Iterm colors
open color-schemes/railscasts/base16-railscasts.dark.256.itermcolors
open color-schemes/lucius/LuciusLight.itermcolors

# Iterm preferences
# http://stratus3d.com/blog/2015/02/28/sync-iterm2-profile-with-dotfiles-repository/
# Specify the preferences directory
defaults write com.googlecode.iterm2.plist PrefsCustomFolder -string "$PWD"
# Tell iTerm2 to use the custom preferences in the directory
defaults write com.googlecode.iterm2.plist LoadPrefsFromCustomFolder -bool true

pip3 install neovim
gem install tmuxinator
xcode-select --install

echo "---"
echo "Please link your dotfiles:"
printf "ln -s $DOTFILES_PATH/zsh/zshrc $DOTFILES_PATH/zsh/.zshrc"
printf "ln -s $DOTFILES_PATH/zsh/zshrc ~/.zshrc"
printf "ln -s $DOTFILES_PATH/tmux_conf ~/.tmux.conf"
printf "ln -s $DOTFILES_PATH/tigrc ~/.tigrc"
printf "ln -s $DOTFILES_PATH/vim/vimrc ~/.config/nvim/init.vim"
echo "---"
echo "If your shell looks weird, install_powerline_fonts.sh is your friend."
